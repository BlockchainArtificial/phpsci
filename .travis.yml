language: php
sudo: false
addons:
  apt:
    packages:
      - libopenblas-dev
      - libopenblas-base
dist: trusty
php:
  - 7.0
  - 7.1
  - 7.2
  - nightly

matrix:
  fast_finish: true
  allow_failures:
    - php: nightly
    - php: 7.1
    - php: 7.0


cache:
  directories:
    - $HOME/.composer/cache


install:
  - curl -s http://getcomposer.org/installer | php
  - php composer.phar install --no-interaction --ignore-platform-reqs

before_script:
    - export USE_CCACHE=1
    - git clone https://github.com/phpsci/phpsci-ext.git
    - cd phpsci-ext
    - ./travis/compile.sh
    - cd ..
    - phpenv config-add travis/build.ini

script:
    - cd $TRAVIS_BUILD_DIR
    - vendor/bin/phpunit


after_success:
  - |
    if [[ $PHPUNIT_FLAGS != "" ]]; then
      wget https://github.com/php-coveralls/php-coveralls/releases/download/v2.0.0/php-coveralls.phar
      php php-coveralls.phar --verbose;
    fi
